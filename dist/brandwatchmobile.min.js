var BrandwatchMobile=new Ext.Application({name:"Brandwatch",useLoadMask:true,tabletStartupScreen:"lib/resources/images/tablet_startup.png",phoneStartupScreen:"lib/resources/images/phone_startup.png",icon:"lib/resources/images/icon.png",glossOnIcon:true,fullscreen:true,launch:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"setFirstApplicationPage",historyUrl:"#"})}});Brandwatch.controllers.BackButton=Ext.extend(Ext.Button,{ui:"back",text:"back",hidden:false,cls:"buttonText",handler:function(){var a=this.backStack.pop();this.setVisible(true);Ext.dispatch(a)},backStack:[],addToBackStack:function(a){var b=false;if(!b){this.backStack.push(a)}this.show()},clearBackStack:function(){this.backStack=[]}});Brandwatch.controllers.backButton=new Brandwatch.controllers.BackButton();Brandwatch.views.Calendar=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){Ext.util.Format.defaultDateFormat="D, d M Y";var c=new Date().add(Date.DAY,-7);var g=new Date();var b=new Date().add(Date.MONTH,-6);var f=Brandwatch.stores.settingsStore.findRecord("name","lastQuery").get("value");var a=new Ext.Toolbar({title:"Start & End"});var h=new Ext.Toolbar({dock:"bottom",items:[{xtype:"button",text:"Cancel",ui:"decline",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"backToDashboard",historyUrl:"dashboard",data:f})}},{xtype:"spacer"},{xtype:"button",text:"Apply",ui:"action",handler:function(){var j=Ext.getCmp("startDate").getValue().format("Y-m-d");var k=Ext.getCmp("endDate").getValue().format("Y-m-d");updateOrAddToStore(Brandwatch.stores.settingsStore,"startDate",j);updateOrAddToStore(Brandwatch.stores.settingsStore,"endDate",k);getSummary(key,f.id,j,k);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"backToDashboard",historyUrl:"overview",data:f})}}]});var d=new Ext.TabBar({id:"tabButtonsBar",layout:{pack:"center"},ui:"dark",items:[{text:"Today",id:"todaySelect",cls:"preDefinedBtn",handler:function(){getDate("todaySelect")}},{text:"7d",id:"weekSelect",cls:"preDefinedBtn",handler:function(){getDate("weekSelect")}},{text:"14d",id:"twoweekSelect",cls:"preDefinedBtn",handler:function(){getDate("twoweekSelect")}},{text:"1m",id:"monthSelect",cls:"preDefinedBtn",handler:function(){getDate("monthSelect")}},{text:"2m",id:"twomonthSelect",cls:"preDefinedBtn",handler:function(){getDate("twomonthSelect")}}]});var i={xtype:"fieldset",id:"calendar",defaults:{labelAlign:"left"},items:[{xtype:"datepickerfield",id:"startDate",name:"startDate",label:"Starts",picker:{slotOrder:["day","month","year"],yearFrom:b.format("Y")},value:c},{xtype:"datepickerfield",id:"endDate",name:"endDate",label:"Ends",picker:{slotOrder:["day","month","year"],yearFrom:b.format("Y")},value:g}]};var e=new Ext.form.FormPanel({dockedItems:[a,h],items:[d,i],scroll:"vertical"});Ext.apply(this,{items:[e]});Brandwatch.views.Calendar.superclass.initComponent.call(this)}});function getDate(c){var a=new Date();var b=new Date();switch(c){case"todaySelect":break;case"weekSelect":a=new Date().add(Date.DAY,-7);break;case"twoweekSelect":a=new Date().add(Date.DAY,-14);break;case"monthSelect":a=new Date().add(Date.MONTH,-1);break;case"twomonthSelect":a=new Date().add(Date.MONTH,-2);break;default:console.log("unknown"+c)}updateDateFields(a,b)}function formatDate(a){return a.format("M d, Y")}function formatlongDate(a){return a.format("d F Y")}function formatshortDate(a){return a.format("M d")}function updateDateFields(a,b){Ext.getCmp("startDate").setValue(a);Ext.getCmp("endDate").setValue(b)}var key=null;var overview=null;var summaryView=null;Ext.regController("Controller",{controller:this,setFirstApplicationPage:function(a){if(!Brandwatch.views.mainView){Brandwatch.views.mainView=new Brandwatch.views.AppMainView();if(Ext.is.Android){hideAddressBar()}}else{Brandwatch.views.mainView.setActiveItem(Brandwatch.views.LoginView)}},onLogin:function(c){var b=c.data.email;var a=c.data.password;this.spinner=new Ext.LoadMask(Ext.getBody(),{msg:"Loading..."});Ext.Ajax.on("beforerequest",this.spinner.show,this.spinner);Ext.Ajax.on("requestcomplete",this.spinner.hide,this.spinner);Ext.Ajax.on("requestexception",this.spinner.hide,this.spinner);Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/login/",method:"POST",params:{username:Brandwatch.views.LoginView.getValues().email,password:Brandwatch.views.LoginView.getValues().password},success:function(g){var d=g.responseText.replace("OK{","{");var f=Ext.util.JSON.decode(d);key=f.key;syncProjects(key);syncAlerts(key);Brandwatch.stores.settingsStore.load();checkUser(b);updateOrAddToStore(Brandwatch.stores.settingsStore,"userEmail",b);updateOrAddToStore(Brandwatch.stores.settingsStore,"key",key);updateOrAddToStore(Brandwatch.stores.settingsStore,"startDate",new Date().add(Date.DAY,-7));updateOrAddToStore(Brandwatch.stores.settingsStore,"endDate",new Date());setLandingPanel();Ext.dispatch({controller:Brandwatch.controllers.controller,action:"showLandingView"})},failure:function(f){var d=Ext.getCmp("login");d.setInstructions("Login failed. Please retry. If you've forgotten your password please use the link below the input 												boxes.")}})},showLandingView:function(){setLandingPanel();Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.LandingView({landingStore:Brandwatch.stores.landingStore}))},onLogout:function(){if(confirm("Are you sure you want to leave Brandwatch Mobile?")){Brandwatch.views.mainView.setActiveItem(Brandwatch.views.LoginView,({type:"slide",direction:"right"}))}},onShowProjectView:function(){Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.ProjectsView({projectStore:Brandwatch.stores.projectStore}))},onShowAlertView:function(){Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.AlertsView({alertsStore:Brandwatch.stores.alertsStore}))},onProjectSelection:function(a){syncQueries(key,a.data.data.id);updateOrAddToStore(Brandwatch.stores.settingsStore,"lastproject",a.data.data);Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.QueryView({queryStore:Brandwatch.stores.queryStore}))},onAlertSelection:function(b){updateOrAddToStore(Brandwatch.stores.settingsStore,"startDate",new Date().add(Date.DAY,-7).format("Y-m-d"));updateOrAddToStore(Brandwatch.stores.settingsStore,"endDate",new Date().format("Y-m-d"));var a=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var c=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");syncAlertMentions(key,b.data.data.queryid,b.data.data.searchparams,a,c);updateOrAddToStore(Brandwatch.stores.settingsStore,"lastalert",b.data.data);updateOrAddToStore(Brandwatch.stores.settingsStore,"searchparams",b.data.data.searchparams);Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.AlertsMentions({alertsMentionsStore:Brandwatch.stores.alertsMentionsStore,record:b.data.data}))},onQuerySelection:function(b){if(summaryView!=null){summaryView.destroy();summaryView=null}updateOrAddToStore(Brandwatch.stores.settingsStore,"startDate",new Date().add(Date.DAY,-7).format("Y-m-d"));updateOrAddToStore(Brandwatch.stores.settingsStore,"endDate",new Date().format("Y-m-d"));var a=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var d=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");getSummary(key,b.data.data.id,a,d);updateOrAddToStore(Brandwatch.stores.settingsStore,"lastquery",b.data.data);var c=new Brandwatch.views.DashboardView({record:b.data.data});Brandwatch.views.mainView.setActiveItem(c)},openCalendar:function(a){Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.Calendar({record:a.data}))},toSentiment:function(a){setTabPanel(0,a)},toHistory:function(a){setTabPanel(1,a)},toPagetype:function(a){setTabPanel(2,a)},toTopsites:function(a){setTabPanel(3,a)},toToptweeters:function(a){setTabPanel(4,a)},toMentions:function(a){setTabPanel(5,a)},onMentionSelection:function(a){Brandwatch.views.mainView.setActiveItem(new Brandwatch.views.Interaction({record:a.data.data}))},backToDashboard:function(a){var b=new Brandwatch.views.DashboardView({record:a.data.data});Brandwatch.views.mainView.setActiveItem(b,{type:"slide",direction:"right"})},showview:function(a){Brandwatch.views.mainView.setActiveItem(a.data.view)},});Brandwatch.controllers.controller=Ext.ControllerManager.get("Controller");(function(){Date.useStrict=false;function b(d){var c=Array.prototype.slice.call(arguments,1);return d.replace(/\{(\d+)\}/g,function(e,f){return c[f]})}Date.formatCodeToRegex=function(d,c){var e=Date.parseCodes[d];if(e){e=typeof e=="function"?e():e;Date.parseCodes[d]=e}return e?Ext.applyIf({c:e.c?b(e.c,c||"{0}"):e.c},e):{g:0,c:null,s:Ext.util.Format.escapeRegex(d)}};var a=Date.formatCodeToRegex;Ext.apply(Date,{parseFunctions:{"M$":function(d,c){var e=new RegExp("\\/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\/");var f=(d||"").match(e);return f?new Date(((f[1]||"")+f[2])*1):null}},parseRegexes:[],formatFunctions:{"M$":function(){return"\\/Date("+this.getTime()+")\\/"}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},getShortMonthName:function(c){return Date.monthNames[c].substring(0,3)},getShortDayName:function(c){return Date.dayNames[c].substring(0,3)},getMonthNumber:function(c){return Date.monthNumbers[c.substring(0,1).toUpperCase()+c.substring(1,3).toLowerCase()]},formatCodes:{d:"Ext.util.Format.leftPad(this.getDate(), 2, '0')",D:"Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"this.getSuffix()",w:"this.getDay()",z:"this.getDayOfYear()",W:"Ext.util.Format.leftPad(this.getWeekOfYear(), 2, '0')",F:"Date.monthNames[this.getMonth()]",m:"Ext.util.Format.leftPad(this.getMonth() + 1, 2, '0')",M:"Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"this.getDaysInMonth()",L:"(this.isLeapYear() ? 1 : 0)",o:"(this.getFullYear() + (this.getWeekOfYear() == 1 && this.getMonth() > 0 ? +1 : (this.getWeekOfYear() >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"this.getFullYear()",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"Ext.util.Format.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"Ext.util.Format.leftPad(this.getHours(), 2, '0')",i:"Ext.util.Format.leftPad(this.getMinutes(), 2, '0')",s:"Ext.util.Format.leftPad(this.getSeconds(), 2, '0')",u:"Ext.util.Format.leftPad(this.getMilliseconds(), 3, '0')",O:"this.getGMTOffset()",P:"this.getGMTOffset(true)",T:"this.getTimezone()",Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var j="Y-m-dTH:i:sP",g=[],f=0,d=j.length;f<d;++f){var h=j.charAt(f);g.push(h=="T"?"'T'":Date.getFormatCode(h))}return g.join(" + ")},U:"Math.round(this.getTime() / 1000)"},isValid:function(n,c,l,j,f,g,e){j=j||0;f=f||0;g=g||0;e=e||0;var k=new Date(n,c-1,l,j,f,g,e);return n==k.getFullYear()&&c==k.getMonth()+1&&l==k.getDate()&&j==k.getHours()&&f==k.getMinutes()&&g==k.getSeconds()&&e==k.getMilliseconds()},parseDate:function(d,f,c){var e=Date.parseFunctions;if(e[f]==null){Date.createParser(f)}return e[f](d,Ext.isDefined(c)?c:Date.useStrict)},getFormatCode:function(d){var c=Date.formatCodes[d];if(c){c=typeof c=="function"?c():c;Date.formatCodes[d]=c}return c||("'"+Ext.util.Format.escape(d)+"'")},createFormat:function(g){var f=[],c=false,e="";for(var d=0;d<g.length;++d){e=g.charAt(d);if(!c&&e=="\\"){c=true}else{if(c){c=false;f.push("'"+Ext.util.Format.escape(e)+"'")}else{f.push(Date.getFormatCode(e))}}}Date.formatFunctions[g]=new Function("return "+f.join("+"))},createParser:function(){var c=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = Date.defaults,","results = String(input).match(Date.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = (new Date()).clearTime();","y = Ext.num(y, Ext.num(def.y, dt.getFullYear()));","m = Ext.num(m, Ext.num(def.m - 1, dt.getMonth()));","d = Ext.num(d, Ext.num(def.d, dt.getDate()));","h  = Ext.num(h, Ext.num(def.h, dt.getHours()));","i  = Ext.num(i, Ext.num(def.i, dt.getMinutes()));","s  = Ext.num(s, Ext.num(def.s, dt.getSeconds()));","ms = Ext.num(ms, Ext.num(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = new Date(y, 0, 1, h, i, s, ms);","v = !strict? v : (strict === true && (z <= 364 || (v.isLeapYear() && z <= 365))? v.add(Date.DAY, z) : null);","}else if(strict === true && !Date.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = new Date(y, m, d, h, i, s, ms);","}","}","}","if(v){","if(zz != null){","v = v.add(Date.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = v.add(Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");return function(l){var e=Date.parseRegexes.length,n=1,f=[],k=[],j=false,d="",h=0,g,m;for(;h<l.length;++h){d=l.charAt(h);if(!j&&d=="\\"){j=true}else{if(j){j=false;k.push(Ext.util.Format.escape(d))}else{g=a(d,n);n+=g.g;k.push(g.s);if(g.g&&g.c){if(g.last){m=g}else{f.push(g.c)}}}}}if(m){f.push(m)}Date.parseRegexes[e]=new RegExp("^"+k.join("")+"$");Date.parseFunctions[l]=new Function("input","strict",b(c,e,f.join("")))}}(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},D:function(){for(var c=[],d=0;d<7;c.push(Date.getShortDayName(d)),++d){}return{g:0,c:null,s:"(?:"+c.join("|")+")"}},l:function(){return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"}},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(Date.getMonthNumber(results[{0}]), 10);\n",s:"("+Date.monthNames.join("|")+")"}},M:function(){for(var c=[],d=0;d<12;c.push(Date.getShortMonthName(d)),++d){}return Ext.applyIf({s:"("+c.join("|")+")"},a("F"))},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{2})"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return a("Y")},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:function(){return a("A")},A:{calcLast:true,g:1,c:"if (results[{0}] == 'AM') {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM)"},g:function(){return a("G")},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},h:function(){return a("H")},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + Ext.util.Format.leftPad(hr, 2, '0') + Ext.util.Format.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + Ext.util.Format.leftPad(hr, 2, '0') + Ext.util.Format.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var e=[],c=[a("Y",1),a("m",2),a("d",3),a("h",4),a("i",5),a("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",a("P",8).c,"}else{",a("O",8).c,"}","}"].join("\n")}];for(var f=0,d=c.length;f<d;++f){e.push(c[f].c)}return{g:1,c:e.join(""),s:[c[0].s,"(?:","-",c[1].s,"(?:","-",c[2].s,"(?:","(?:T| )?",c[3].s,":",c[4].s,"(?::",c[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}}})}());Ext.apply(Date.prototype,{dateFormat:function(a){if(Date.formatFunctions[a]==null){Date.createFormat(a)}return Date.formatFunctions[a].call(this)},getTimezone:function(){return this.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")},getGMTOffset:function(a){return(this.getTimezoneOffset()>0?"-":"+")+Ext.util.Format.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+(a?":":"")+Ext.util.Format.leftPad(Math.abs(this.getTimezoneOffset()%60),2,"0")},getDayOfYear:function(){var b=0,e=this.clone(),a=this.getMonth(),c;for(c=0,e.setDate(1),e.setMonth(0);c<a;e.setMonth(++c)){b+=e.getDaysInMonth()}return b+this.getDate()-1},getWeekOfYear:function(){var a=86400000,b=7*a;return function(){var d=Date.UTC(this.getFullYear(),this.getMonth(),this.getDate()+3)/a,c=Math.floor(d/7),e=new Date(c*b).getUTCFullYear();return c-Math.floor(Date.UTC(e,0,7)/b)+1}}(),isLeapYear:function(){var a=this.getFullYear();return !!((a&3)==0&&(a%100||(a%400==0&&a)))},getFirstDayOfMonth:function(){var a=(this.getDay()-(this.getDate()-1))%7;return(a<0)?(a+7):a},getLastDayOfMonth:function(){return this.getLastDateOfMonth().getDay()},getFirstDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),1)},getLastDateOfMonth:function(){return new Date(this.getFullYear(),this.getMonth(),this.getDaysInMonth())},getDaysInMonth:function(){var a=[31,28,31,30,31,30,31,31,30,31,30,31];return function(){var b=this.getMonth();return b==1&&this.isLeapYear()?29:a[b]}}(),getSuffix:function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},clone:function(){return new Date(this.getTime())},isDST:function(){return new Date(this.getFullYear(),0,1).getTimezoneOffset()!=this.getTimezoneOffset()},clearTime:function(f){if(f){return this.clone().clearTime()}var b=this.getDate();this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);if(this.getDate()!=b){for(var a=1,e=this.add(Date.HOUR,a);e.getDate()!=b;a++,e=this.add(Date.HOUR,a)){}this.setDate(b);this.setHours(e.getHours())}return this},add:function(b,c){var e=this.clone();if(!b||c===0){return e}switch(b.toLowerCase()){case Date.MILLI:e.setMilliseconds(this.getMilliseconds()+c);break;case Date.SECOND:e.setSeconds(this.getSeconds()+c);break;case Date.MINUTE:e.setMinutes(this.getMinutes()+c);break;case Date.HOUR:e.setHours(this.getHours()+c);break;case Date.DAY:e.setDate(this.getDate()+c);break;case Date.MONTH:var a=this.getDate();if(a>28){a=Math.min(a,this.getFirstDateOfMonth().add("mo",c).getLastDateOfMonth().getDate())}e.setDate(a);e.setMonth(this.getMonth()+c);break;case Date.YEAR:e.setFullYear(this.getFullYear()+c);break}return e},between:function(c,a){var b=this.getTime();return c.getTime()<=b&&b<=a.getTime()}});Date.prototype.format=Date.prototype.dateFormat;function getToolBarTitle(){return Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").name}Brandwatch.controllers.QueryToolbar=Ext.extend(Ext.Toolbar,{title:"",cls:"queryNameBar",ui:"light",initComponent:function(){this.title='<div class="queryName">'+getToolBarTitle()+"</div>"}});function verifyResponse(a){if(a.indexOf("OK")==0){return a.replace("OK","")}return a}function syncProjects(a){Brandwatch.stores.projectStore.removeAll();Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/projects",method:"GET",headers:{"x-bw-auth":a},success:function(f){var d=Ext.util.JSON.decode(verifyResponse(f.responseText));for(var c=0;c<d.length;c++){var g=d[c].id;var b=d[c].name;Brandwatch.stores.projectStore.add({id:g,name:b})}Brandwatch.stores.landingStore.getById("1").data.narrative="Total: "+d.length;Brandwatch.stores.landingStore.fireEvent("datachanged")},failure:function(b){console.log("failure loading projects",b)}})}function syncAlerts(a){Brandwatch.stores.alertsStore.removeAll();Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/alerts",method:"GET",headers:{"x-bw-auth":a},success:function(h){var f=Ext.util.JSON.decode(verifyResponse(h.responseText));for(var d=0;d<f.length;d++){var j=f[d].id;var g=f[d].queryId;var c=f[d].name;var b=f[d].searchString;Brandwatch.stores.alertsStore.add({id:j,queryid:g,name:c,searchparams:b})}Brandwatch.stores.landingStore.getById("4").data.narrative="Total: "+f.length;Brandwatch.stores.landingStore.fireEvent("datachanged")},failure:function(b){console.log("failure loading alerts",b)}})}function syncAlertMentions(k,b,l,a,f,j){j=typeof(j)!="undefined"?j:0;var d="10";if(j==0){Brandwatch.stores.alertsMentionsStore.removeAll()}var c={queryId:b,startDate:a,endDate:f,startIndex:j,maxResults:d};var g=l.split("&");for(var e=0;e<g.length;e++){var h=g[e].split("=");c[h[0]]=h[1]}Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/mentions",method:"GET",headers:{"x-bw-auth":k},params:c,success:function(z){var r=Brandwatch.stores.alertsMentionsStore;var y=Ext.util.JSON.decode(verifyResponse(z.responseText));var C=60;var m="...";var s=r.getCount()+1;for(var x=0;x<y.items.length;x++){var D=y.items[x].title;var B=y.items[x].formatted_date;var t=y.items[x].summary;t=fixJSON(t);var A=cleanSummary(t);A=A.substring(0,C)+m;var o=y.items[x].url;var p=y.items[x].brandSentiment;var E=y.items[x].domain;var q=y.items[x].site_type;var v=y.items[x].seomoz_domain_mozrank;var n=y.items[x].geo_location;var w=y.items[x].language;var u=y.items[x].seomoz_num_backlinks;r.add({mentionindex:s,mentiontitle:D,mentiondate:B,mentionsnippet:t,mentionshortsnippet:A,mentionurl:o,mentionsentiment:p,mentiondomain:E,mentionpagetype:q,mentionmoz:v,mentionlocation:n,mentionlanguage:w,mentionbacklinks:u});s+=1}r.fireEvent("datachanged")},failure:function(i){console.log("failure loading mentions",i)}})}function syncQueries(b,a){Brandwatch.stores.queryStore.removeAll();Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/queries",method:"GET",headers:{"x-bw-auth":b},params:{projectId:a},success:function(g){var f=Ext.util.JSON.decode(verifyResponse(g.responseText));for(var d=0;d<f.length;d++){var h=f[d].id;var c=f[d].name;Brandwatch.stores.queryStore.add({id:h,name:c})}},failure:function(c){console.log("failure loading queries",c)}})}function getSummary(b,c,a,d){if(Brandwatch.stores.filteredMentionsStore.getCount()!=0){Brandwatch.stores.filteredMentionsStore.removeAll()}Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/summary",method:"GET",headers:{"x-bw-auth":b},params:{queryId:c,startDate:a,endDate:d},success:function(g){var f=Ext.util.JSON.decode(verifyResponse(g.responseText));populateSentiment(f);populateHistory(f);populatePagetypes(f);populateTopsites(f);populateMentions(b,c,a,d)},failure:function(f){console.log("failure loading dashboard components",f)}})}function populateSentiment(c){Brandwatch.stores.sentimentStore.removeAll();var d=c.metrics.mentions;var b=c.metrics.negative;var a=c.metrics.positive;var e=c.metrics.neutral;Brandwatch.stores.sentimentStore.add({name:"Negative",value:b});Brandwatch.stores.sentimentStore.add({name:"Positive",value:a});Brandwatch.stores.sentimentStore.add({name:"Neutral",value:e})}function populateHistory(j){Brandwatch.stores.historyStore.removeAll();for(var d=0;d<j.brandData.days.length;d++){var f=j.brandData.days[d].date.replace("-","/");f=f.replace("-","/");f=f.split("T")[0];var b=new Date(f);b=formatDate(b);var h=new Date(f);var c=j.brandData.days[d].mentions;var g=j.brandData.days[d].negative;var e=j.brandData.days[d].positive;var a=j.brandData.days[d].neutral;Brandwatch.stores.historyStore.add({date:b,formatteddate:h,mentions:c,negative:g,positive:e,neutral:a})}}function populatePagetypes(d){Brandwatch.stores.pagetypeStore.removeAll();var g=d.siteTypes.blog;var b=d.siteTypes.forum;var a=d.siteTypes.general;var c=d.siteTypes.news;var f=d.siteTypes.twitter;var e=d.siteTypes.video;Brandwatch.stores.pagetypeStore.add({name:"Blog",value:g});Brandwatch.stores.pagetypeStore.add({name:"Forum",value:b});Brandwatch.stores.pagetypeStore.add({name:"General",value:a});Brandwatch.stores.pagetypeStore.add({name:"News",value:c});Brandwatch.stores.pagetypeStore.add({name:"Twitter",value:f});Brandwatch.stores.pagetypeStore.add({name:"Video",value:e})}function populateTopsites(b){Brandwatch.stores.topsitesStore.removeAll();for(var a=0;a<b.topDomains.length;a++){var d=b.topDomains[a].name;var c=b.topDomains[a].volume;Brandwatch.stores.topsitesStore.add({sitename:d,sitevolume:c})}}function populateMentions(i,f,d,e,g,a,b,c,h){a=typeof(a)!="undefined"?a:"";b=typeof(b)!="undefined"?b:"";c=typeof(c)!="undefined"?c:"";g=typeof(g)!="undefined"?g:Brandwatch.stores.mentionsStore;h=typeof(h)!="undefined"?h:0;if(h==0){g.removeAll()}Ext.Ajax.request({url:"http://bwjsonapi.nodejitsu.com/mentions",method:"GET",headers:{"x-bw-auth":i},params:{queryId:f,startDate:d,endDate:e,startIndex:h,maxResults:"10",sentiment:a,siteType:b,site:c},success:function(v){var u=Ext.util.JSON.decode(verifyResponse(v.responseText));var y=60;var j="...";var o=g.getCount()+1;for(var t=0;t<u.items.length;t++){var z=u.items[t].title;var x=u.items[t].formatted_date;var p=u.items[t].summary;p=fixJSON(p);var w=cleanSummary(p);w=w.substring(0,y)+j;var l=u.items[t].url;var m=u.items[t].brandSentiment;var A=u.items[t].domain;var n=u.items[t].site_type;var r=u.items[t].seomoz_domain_mozrank;var k=u.items[t].geo_location;var s=u.items[t].language;var q=u.items[t].seomoz_num_backlinks;g.add({mentionindex:o,mentiontitle:z,mentiondate:x,mentionsnippet:p,mentionshortsnippet:w,mentionurl:l,mentionsentiment:m,mentiondomain:A,mentionpagetype:n,mentionmoz:r,mentionlocation:k,mentionlanguage:s,mentionbacklinks:q});o+=1}g.fireEvent("datachanged")},failure:function(j){console.log("failure loading mentions",j)}})}function fixJSON(a){if(typeof a!="string"){a="There is no summary to display."}return a}function cleanSummary(a){var b=a.replace(/<span class='matchedTerm'>/g,"");b=b.replace(/<\/span>/g,"");b=b.replace(/<wbr \/>/g,"");return b}function setTabPanel(b,a){if(summaryView==null){summaryView=new Brandwatch.views.CarouselView({record:a})}summaryView.tabBar.onTabTap(summaryView.tabBar.getComponent(b));Brandwatch.views.mainView.setActiveItem(summaryView)}function setLandingPanel(){var b=Brandwatch.stores.settingsStore.findRecord("name","lastproject");var a=Brandwatch.stores.settingsStore.findRecord("name","lastQuery");if(b!=null){Brandwatch.stores.landingStore.getById("2").data.narrative=b.get("value").name}else{Brandwatch.stores.landingStore.getById("2").data.narrative="No last project yet."}if(a!=null){Brandwatch.stores.landingStore.getById("3").data.narrative=a.get("value").name}else{Brandwatch.stores.landingStore.getById("3").data.narrative="No last query yet."}}function checkUser(c){var d=Brandwatch.stores.settingsStore.findRecord("name","userEmail");if(d!=null){var b=d.get("value");var a=c;if(b!=a){lastProject=Brandwatch.stores.settingsStore.findRecord("name","lastproject");lastQuery=Brandwatch.stores.settingsStore.findRecord("name","lastQuery");Brandwatch.stores.settingsStore.remove(lastProject);Brandwatch.stores.settingsStore.remove(lastQuery)}}}function updateOrAddToStore(a,b,c){if(a.findRecord("name",b)==null){a.add({name:b,value:c})}else{a.findRecord("name",b).set("value",c);a.findRecord("name",b).dirty=true}a.sync()}function addIfDoesntExist(a,b,c){if(a.findRecord("name",b)==null){a.add({name:b,value:c})}}Ext.regModel("AlertsModel",{fields:[{name:"id",type:"int"},{name:"queryid",type:"int"},{name:"name",type:"string"},{name:"searchparams",type:"string"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"name"}]});Ext.regModel("HistoryModel",{fields:[{name:"date",type:"string"},{name:"formatteddate",type:"date"},{name:"mentions",type:"number"},{name:"negative",type:"number"},{name:"positive",type:"number"},{name:"neutral",type:"number"}]});Ext.regModel("LandingModel",{fields:[{name:"id",type:"string"},{name:"title",type:"string"},{name:"narrative",type:"string"}],validations:[{type:"presence",field:"title"}]});Ext.regModel("MentionsModel",{fields:[{name:"mentionindex",type:"string"},{name:"mentiontitle",type:"string"},{name:"mentiondate",type:"string"},{name:"mentionsnippet",type:"string"},{name:"mentionshortsnippet",type:"string"},{name:"mentionurl",type:"string"},{name:"mentionsentiment",type:"string"},{name:"mentiondomain",type:"string"},{name:"mentionpagetype",type:"string"},{name:"mentionmoz",type:"string"},{name:"mentionlocation",type:"string"},{name:"mentionlanguage",type:"string"},{name:"mentionbacklinks",type:"string"}]});Ext.regModel("PagetypeModel",{fields:[{name:"name",type:"string"},{name:"value",type:"number"}]});Ext.regModel("ProjectModel",{fields:[{name:"id",type:"int"},{name:"name",type:"string"}],validations:[{type:"presence",field:"id"},{type:"presence",field:"name"}]});Ext.regModel("QueryModel",{fields:[{name:"id",type:"string"},{name:"name",type:"string"}]});Ext.regModel("SentimentModel",{fields:[{name:"name",type:"string"},{name:"value",type:"number"}]});Ext.regModel("SettingsModel",{fields:[{name:"id",type:"integer"},{name:"name",type:"string"},{name:"value",type:"object"},],proxy:{type:"localstorage",id:"my-proxy"}});Ext.regModel("TopsitesModel",{fields:[{name:"sitename",type:"string"},{name:"sitevolume",type:"number"}]});Ext.regStore("AlertsMentionsStore",{model:"MentionsModel",load:function(h,c){var b=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var d=Brandwatch.stores.settingsStore.findRecord("name","lastalert").get("value").queryid;var a=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var e=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");var g=Brandwatch.stores.settingsStore.findRecord("name","searchparams").get("value");var f=this.getCount==0?0:this.getCount()+1;syncAlertMentions(b,d,g,a,e,f)}});Brandwatch.stores.alertsMentionsStore=Ext.StoreMgr.get("AlertsMentionsStore");Ext.regStore("AlertsStore",{model:"AlertsModel"});Brandwatch.stores.alertsStore=Ext.StoreMgr.get("AlertsStore");Ext.regStore("FilteredMentionsStore",{model:"MentionsModel",load:function(h,d){var c=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var e=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;var b=Brandwatch.stores.settingsStore.findRecord("name","lastproject").get("value").id;var a=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var f=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");var g=this.getCount()+1;populateMentions(c,e,a,f,this,null,null,null,g=g)}});Brandwatch.stores.filteredMentionsStore=Ext.StoreMgr.get("FilteredMentionsStore");Ext.regStore("HistoryStore",{model:"HistoryModel"});Brandwatch.stores.historyStore=Ext.StoreMgr.get("HistoryStore");Ext.regStore("LandingStore",{model:"LandingModel",data:[{id:1,title:"Projects",narrative:""},{id:2,title:"Last viewed project",narrative:""},{id:3,title:"Last viewed query",narrative:""},{id:4,title:"Alerts",narrative:""}]});Brandwatch.stores.landingStore=Ext.StoreMgr.get("LandingStore");Ext.regStore("MentionsStore",{model:"MentionsModel",load:function(g,c){var b=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var d=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;var a=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var e=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");var f=this.getCount==0?0:this.getCount()+1;populateMentions(b,d,a,e,this,null,null,null,f=f)}});Brandwatch.stores.mentionsStore=Ext.StoreMgr.get("MentionsStore");Ext.regStore("PagetypeStore",{model:"PagetypeModel"});Brandwatch.stores.pagetypeStore=Ext.StoreMgr.get("PagetypeStore");Ext.regStore("ProjectStore",{model:"ProjectModel"});Brandwatch.stores.projectStore=Ext.StoreMgr.get("ProjectStore");Ext.regStore("QueryStore",{model:"QueryModel"});Brandwatch.stores.queryStore=Ext.StoreMgr.get("QueryStore");Ext.regStore("SentimentStore",{model:"SentimentModel"});Brandwatch.stores.sentimentStore=Ext.StoreMgr.get("SentimentStore");Ext.regStore("SettingsStore",{model:"SettingsModel",autoLoad:true,autoSave:true});Brandwatch.stores.settingsStore=Ext.StoreMgr.get("SettingsStore");Ext.regStore("TopsitesStore",{model:"TopsitesModel"});Brandwatch.stores.topsitesStore=Ext.StoreMgr.get("TopsitesStore");Brandwatch.views.AlertsMentions=Ext.extend(Ext.Panel,{fullscreen:true,layout:"fit",listeners:{show:function(a){Brandwatch.stores.alertsMentionsStore.clearFilter(false)}},initComponent:function(){var a=Brandwatch.stores.settingsStore.findRecord("name","lastalert");this.topToolbar=new Ext.Toolbar({title:"Mentions",cls:"dashboardToolbar",items:[Brandwatch.controllers.backButton]});var b=new Ext.Toolbar({title:'<div class="queryName">'+a.get("value").name+"</div>",cls:"queryNameBar",ui:"light"});this.dockedItems=[this.topToolbar,b];this.sitesList=new Ext.List({scroll:"vertical",store:Brandwatch.stores.alertsMentionsStore,emptyText:'<div style="margin:5px;">No mentions cached.</div>',onItemDisclosure:true,plugins:[{ptype:"listpaging",autoPaging:false}],itemTpl:'<div class="list-item-title">{mentionindex}. {mentiontitle}</div><div class="list-item-narrative">{mentionshortsnippet}</div>'});this.sitesList.on("itemtap",function(d,f,g,h){var c=d.getRecord(g);this.onMentionSelection(c)},this),this.items=[this.sitesList];Brandwatch.views.AlertsMentions.superclass.initComponent.call(this)},onMentionSelection:function(a){var b={controller:Brandwatch.controllers.controller,action:"onAlertSelection",data:{data:this.record}};Brandwatch.controllers.backButton.addToBackStack(b);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onMentionSelection",data:a})}});Brandwatch.views.AlertsView=Ext.extend(Ext.Panel,{fullscreen:true,layout:"card",initComponent:function(){Brandwatch.stores.alertsStore.clearFilter();this.backButton=Brandwatch.controllers.backButton;this.topToolbar=new Ext.Toolbar({title:"Alerts",items:[this.backButton,{xtype:"spacer"},{iconCls:"search",iconMask:true,ui:"plain",listeners:{scope:this,tap:this.onSearchTap}}]});this.cancelSearchAlertsToolbar=new Ext.Toolbar({hidden:true,title:"Search Alerts",items:[{xtype:"button",text:"cancel",ui:"back",cls:"buttonText",listeners:{scope:this,tap:this.onSearchCancel}}]});this.searchBar=new Ext.Toolbar({ui:"light",hidden:true,cls:"searchBar",items:[{xtype:"searchfield",placeHolder:"Search",name:"searchfield",listeners:{scope:this,keyup:this.onSearchInput}}]});this.dockedItems=[this.topToolbar,this.cancelSearchAlertsToolbar,this.searchBar];this.alertsList=new Ext.List({store:this.alertsStore,emptyText:'<div style="margin:5px;">You have no alerts, please create one in your desktop version of Brandwatch.</div>',onItemDisclosure:true,itemTpl:'<div class="list-item-title">{name}</div><div class="list-item-narrative">{narrative}</div>'});this.listPanel=new Ext.Panel({items:[this.alertsList],scroll:"vertical",layout:"fit"});this.alertsList.on("itemtap",function(b,c,d,f){var a=b.getRecord(d);this.onAlertSelection(a)},this),this.items=[this.listPanel];Brandwatch.views.LandingView.superclass.initComponent.call(this)},onAlertSelection:function(a){var b={controller:Brandwatch.controllers.controller,action:"onShowAlertView"};Brandwatch.controllers.backButton.addToBackStack(b);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onAlertSelection",data:a,historyUrl:"alerts"})},onSearchInput:function(b){var a=b.getValue().toLowerCase();Brandwatch.stores.alertsStore.filterBy(function(c){if(c.get("name").toLowerCase().match(".*"+a+".*")){return true}return false})},onSearchTap:function(){this.cancelSearchAlertsToolbar.setVisible(true);this.cancelSearchAlertsToolbar.setPosition(0,0);this.cancelSearchAlertsToolbar.setWidth(this.getWidth());this.topToolbar.hide();this.searchBar.setVisible(true);this.searchBar.setWidth(this.getWidth());this.searchBar.setHeight(40);this.listPanel.setPosition(0,40)},onSearchCancel:function(){this.cancelSearchAlertsToolbar.hide();this.topToolbar.setVisible(true);this.searchBar.hide();this.listPanel.setPosition(0,0)}});Brandwatch.views.AppMainView=Ext.extend(Ext.Panel,{fullscreen:true,layout:"card",cardSwitchAnimation:"slide",initComponent:function(){Ext.apply(Brandwatch.views,{LoginView:new Brandwatch.views.LoginView()});hideAddressBar=function(){window.scrollTo(0,0);var a=document.height;var b=window.outerHeight;if(b>a){b-=250;document.body.style.height=b+"px"}window.scrollTo(0,1)},this.items=[Brandwatch.views.LoginView];Brandwatch.views.AppMainView.superclass.initComponent.call(this)}});Brandwatch.views.FilteredMentions=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){this.sitesList=new Ext.List({scroll:"vertical",store:Brandwatch.stores.filteredMentionsStore,emptyText:'<div style="margin:5px;">No mentions cached.</div>',onItemDisclosure:true,plugins:[{ptype:"listpaging",autoPaging:false}],itemTpl:'<div class="list-item-title">{mentionindex}. {mentiontitle}</div><div class="list-item-narrative">{mentionshortsnippet}</div>'});this.sitesList.on("itemtap",function(b,c,d,f){var a=b.getRecord(d);this.onMentionSelection(a)},this),this.items=[this.sitesList];Brandwatch.views.FilteredMentions.superclass.initComponent.call(this)},onMentionSelection:function(a){var b={controller:Brandwatch.controllers.controller,action:"showview",data:{view:Brandwatch.views.mainView.getActiveItem()}};Brandwatch.controllers.backButton.addToBackStack(b);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onMentionSelection",data:a})}});Brandwatch.views.History=Ext.extend(Ext.Panel,{fullscreen:true,layout:"fit",iconCls:"history",listeners:{show:function(a){Brandwatch.stores.filteredMentionsStore.clearFilter(false);this.showFront()}},initComponent:function(){var c=this;var b=new Ext.chart.Chart({cls:"line1",id:"historyTab",store:Brandwatch.stores.historyStore,background:{fill:"#f7f7f7"},animate:false,legend:{dock:false,position:{landscape:"right",portrait:"bottom"}},axes:[{type:"Numeric",position:"left",fields:["mentions","negative","positive","neutral"],minorTickSteps:1},{type:"Category",position:"bottom",fields:["date"]}],series:[{type:"line",listeners:{itemtap:function(d,h,g){var f=h.storeItem.get("formatteddate");var e=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var i=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;populateMentions(e,i,f,f.add(Date.MINUTE,1439),Brandwatch.stores.filteredMentionsStore);c.showBack(h,"mentions")}},highlight:{size:7,radius:7},smooth:true,axis:"left",xField:"date",yField:"mentions",title:"Total"},{type:"line",listeners:{itemtap:function(e,i,h){var g=i.storeItem.get("formatteddate");var d="negative";var f=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var j=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;populateMentions(f,j,g,g.add(Date.MINUTE,1439),Brandwatch.stores.filteredMentionsStore,d);c.showBack(i,d)}},highlight:{size:7,radius:7},smooth:true,axis:"left",xField:"date",yField:"negative",title:"Negative"},{type:"line",listeners:{itemtap:function(e,i,h){var g=i.storeItem.get("formatteddate");var d="positive";var f=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var j=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;populateMentions(f,j,g,g,Brandwatch.stores.filteredMentionsStore,d);c.showBack(i,d)}},highlight:{size:7,radius:7},axis:"left",smooth:true,xField:"date",yField:"positive",title:"Positive"},{type:"line",listeners:{itemtap:function(e,i,h){var g=i.storeItem.get("formatteddate");var d="neutral";var f=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var j=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;populateMentions(f,j,g,g,Brandwatch.stores.filteredMentionsStore,d);c.showBack(i,d)}},highlight:{size:7,radius:7},axis:"left",smooth:true,xField:"date",yField:"neutral",title:"Neutral"}]});var a=new Brandwatch.views.FilteredMentions({id:"filteredMentionsHistory",location:"toHistory"});Ext.apply(this,{layout:"card",cardSwitchAnimation:"flip",items:[b,a]});Brandwatch.views.History.superclass.initComponent.apply(this)},showFront:function(){this.setActiveItem("historyTab")},showBack:function(d,a){var b=d.storeItem.get("date");b=b.replace(", 2012","");var e="";var c=a;if(c=="neutral"){e=d.storeItem.get("neutral")}else{if(c=="positive"){e=d.storeItem.get("positive")}else{if(c=="negative"){e=d.storeItem.get("negative")}else{e=d.storeItem.get("mentions")}}}var f=e+" "+c+" on "+b;this.setActiveItem("filteredMentionsHistory");this.fireEvent("showpanelback",f)}});Brandwatch.views.Interaction=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){var e=Brandwatch.stores.settingsStore.findRecord("name","lastquery");var a=new Ext.Toolbar({dock:"top"});var d=new Ext.Panel({floating:true,modal:true,centered:false,width:Ext.is.Phone?260:400,height:Ext.is.Phone?220:400,styleHtmlContent:true,dockedItems:a,scroll:"vertical",html:'<img src="lib/resources/images/engagement.png"/>',cls:"htmlcontent"});var j=new Ext.form.Select({label:"Assignment",border:"3 3 3 3",options:[{text:"giles@brandwatch.com",value:"first"},{text:"alena@brandwatch.com",value:"second"},{text:"katja@brandwatch.com",value:"third"}]});var h=new Ext.form.Select({label:"Priority",border:"3 3 3 3",options:[{text:"high",value:"first"},{text:"medium",value:"second"},{text:"low",value:"third"}]});var g=new Ext.form.Select({label:"Status",border:"3 3 3 3",options:[{text:"open",value:"first"},{text:"pending",value:"second"},{text:"closed",value:"third"}]});var b=new Ext.Panel({floating:true,modal:true,centered:false,width:Ext.is.Phone?260:400,height:Ext.is.Phone?220:400,styleHtmlContent:true,dockedItems:a,scroll:"vertical",cls:"htmlcontent",items:[j,h,g]});this.showEngagement=function(k,l){d.setCentered(true);a.setTitle("Engagement");d.show()};this.showWorkflow=function(k,l){b.setCentered(true);a.setTitle("Workflow");b.show()};this.engageButton=new Ext.Button({iconCls:"shuffle",iconMask:true,scope:this});this.workflowButton=new Ext.Button({iconCls:"bubble",iconMask:true,handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller})},scope:this});this.queryToolbar=new Brandwatch.controllers.QueryToolbar({toolBarTitle:this.record.name});this.tabBar=new Ext.TabBar({ui:"dark",dock:"bottom",layout:{pack:"center"},items:[{text:"Engagement",iconCls:"contract",handler:this.showEngagement},{text:"Workflow",iconCls:"nodes1",handler:this.showWorkflow}]});var c=this;var i=new Ext.Panel({id:"singleMentionTab",scroll:"vertical",html:'<div id="top"> <div id="date">'+this.record.mentiondate+'</div> <div id="title">'+this.record.mentiontitle+'</div> <div id="url">'+this.record.mentionurl+'</div></div> <div id="main">'+this.record.mentionsnippet+"</div>"});var f=new Brandwatch.views.MetaData({record:this.record});Ext.apply(this,{layout:"card",dockedItems:[{xtype:"toolbar",title:"Interaction",id:"metatoolbar",cls:"dashboardToolbar",items:[Brandwatch.controllers.backButton,{xtype:"spacer"},{xtype:"button",id:"infoBtn",iconCls:"info",iconMask:true,ui:"plain",handler:function(){c.showOtherSide()}}]},this.queryToolbar,this.tabBar],items:[i,f]});Brandwatch.views.Interaction.superclass.initComponent.call(this)},showOtherSide:function(a){if(this.getDockedComponent("metatoolbar").title=="Interaction"){this.setActiveItem("metadataCard");this.getDockedComponent("metatoolbar").setTitle("Info")}else{this.setActiveItem("singleMentionTab");this.getDockedComponent("metatoolbar").setTitle("Interaction")}}});Brandwatch.views.Mentions=Ext.extend(Ext.Panel,{id:"mentionsTab",iconCls:"mentions",fullscreen:true,layout:"fit",listeners:{show:function(a){Brandwatch.stores.mentionsStore.clearFilter(false)}},initComponent:function(){this.sitesList=new Ext.List({scroll:"vertical",store:Brandwatch.stores.mentionsStore,emptyText:'<div style="margin:5px;">No mentions cached.</div>',onItemDisclosure:true,plugins:[{ptype:"listpaging",pageSize:10,autoPaging:false}],itemTpl:'<div class="list-item-title">{mentionindex}. {mentiontitle}</div><div class="list-item-narrative">{mentionshortsnippet}</div>'});this.sitesList.on("itemtap",function(b,c,d,f){var a=b.getRecord(d);this.onMentionSelection(a)},this),this.items=[this.sitesList];Brandwatch.views.Mentions.superclass.initComponent.call(this)},onMentionSelection:function(a){var b={controller:Brandwatch.controllers.controller,action:"toMentions"};Brandwatch.controllers.backButton.addToBackStack(b);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onMentionSelection",url:"single",data:a})}});Brandwatch.views.MetaData=Ext.extend(Ext.Panel,{layout:"fit",id:"metadataCard",initComponent:function(){this.metadata=new Ext.Panel({scroll:"vertical",html:'<div id="date">Found  '+this.record.mentiondate+'</div><div id="url">URL  '+this.record.mentionurl+'</div><div id="sentiment">Sentiment  '+this.record.mentionsentiment+'</div><div id="domain">Site  '+this.record.mentiondomain+'</div><div id="pagetype">Page type  '+this.record.mentionpagetype+'</div><div id="moz">mozRank '+this.record.mentionmoz+'</div><div id="location">Location '+this.record.mentionlocation+'</div><div id="language">Language '+this.record.mentionlanguage+'</div><div id="backlinks">Backlinks '+this.record.mentionbacklinks+"</div>"}),this.items=[this.metadata];Brandwatch.views.MetaData.superclass.initComponent.call(this)}});Brandwatch.views.PageType=Ext.extend(Ext.Panel,{fullscreen:true,layout:"fit",iconCls:"pagetype",listeners:{show:function(a){Brandwatch.stores.filteredMentionsStore.clearFilter(false);this.showFront()}},initComponent:function(){var c=this;var b=new Ext.chart.Chart({id:"pagetypeTab",store:Brandwatch.stores.pagetypeStore,background:{fill:"#f7f7f7"},shadow:false,axes:[{type:"Category",position:"bottom",fields:["name"]},{type:"Numeric",position:"left",fields:["value"]}],series:[{type:"column",label:{display:"outside","text-anchor":"middle",field:"value",contrast:true},xField:"name",yField:["value"],axis:"bottom",highlight:true,showInLegend:true,listeners:{itemtap:function(i,l,f){var e=l.storeItem.get("name").toLowerCase();var d="";var k=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var j=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;var g=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var h=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");populateMentions(k,j,g,h,Brandwatch.stores.filteredMentionsStore,d,e);c.showBack(l)}}}]});var a=new Brandwatch.views.FilteredMentions({id:"filteredMentionsPagetype",location:"toPagetype"});Ext.apply(this,{layout:"card",cardSwitchAnimation:"flip",items:[b,a]});Brandwatch.views.PageType.superclass.initComponent.apply(this)},showFront:function(){this.setActiveItem("pagetypeTab")},showBack:function(b){var c=b.storeItem.get("value");var a=b.storeItem.get("name");var d=a+": "+c;this.setActiveItem("filteredMentionsPagetype");this.fireEvent("showpanelback",d)}});Brandwatch.views.Sentiment=Ext.extend(Ext.Panel,{fullscreen:true,layout:"fit",iconCls:"sentiment",listeners:{show:function(a){Brandwatch.stores.filteredMentionsStore.clearFilter(false);this.showFront()}},initComponent:function(){var a=function(i,h,f,e){var j="";var g=0;var k=i.findExact(h,f);if(k!=-1){j=i.getAt(k);g=j.get(e)}return g};var d=this;var c=new Ext.chart.Chart({cls:"pie",id:"sentimentTab",theme:"Demo",store:Brandwatch.stores.sentimentStore,background:{fill:"#f7f7f7"},shadow:false,animate:true,insetPadding:10,legend:{dock:false,position:{landscape:"right",portrait:"bottom"}},interactions:[{type:"piegrouping"}],series:[{type:"pie",field:"name",angleField:"value",showInLegend:true,donut:"25",highlight:false,colorSet:["#CA272D","#69BF2F","#AAA"],listeners:{labelOverflow:function(e,f){f.useCallout=true},itemtap:function(g,j){var i=j.storeItem.get("name").toLowerCase();var h=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var k=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;var f=Brandwatch.stores.settingsStore.findRecord("name","lastproject").get("value").id;var e=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var l=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");populateMentions(h,k,e,l,Brandwatch.stores.filteredMentionsStore,i);d.showBack(j)}},callouts:{renderer:function(f,e){f.label.setAttributes({text:e.get("name")},true)},filter:function(){return false},lines:{"stroke-width":2,offsetFromViz:20},label:{font:"italic 14px Arial"},styles:{font:"14px Arial"}},label:{display:"rotate","text-anchor":"middle",contrast:true,field:"name",renderer:function(e){return a(Brandwatch.stores.sentimentStore,"name",e,"value")}}}]});var b=new Brandwatch.views.FilteredMentions({id:"filteredMentionsSentiment",location:"toSentiment"});Ext.apply(this,{layout:"card",cardSwitchAnimation:"flip",items:[c,b]});Brandwatch.views.Sentiment.superclass.initComponent.apply(this)},showFront:function(){this.setActiveItem("sentimentTab")},showBack:function(b){var c=b.storeItem.get("value");var a=b.storeItem.get("name");var d=a+": "+c;this.setActiveItem("filteredMentionsSentiment");this.fireEvent("showpanelback",d)}});Brandwatch.views.TopSites=Ext.extend(Ext.Panel,{fullscreen:true,layout:"fit",iconCls:"topsites",listeners:{show:function(a){Brandwatch.stores.filteredMentionsStore.clearFilter(false);this.showFront()}},initComponent:function(){var c=this;var b=new Ext.List({id:"topsitesTab",store:Brandwatch.stores.topsitesStore,emptyText:'<div style="margin:5px;">No sites cached.</div>',singleSelect:true,itemTpl:'<div class="list-item-title">{sitename} <div class="list-item-volume">{sitevolume}</div> </div>',listeners:{itemtap:function(i,k,o,l){var g=i.getRecord(o).get("sitename").toLowerCase();var f="";var d="";var n=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var m=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;var h=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var j=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");populateMentions(n,m,h,j,Brandwatch.stores.filteredMentionsStore,d,f,g);c.showBack(i.getRecord(o))}}});var a=new Brandwatch.views.FilteredMentions({id:"filteredMentionsTopsites",location:"toTopsites"});Ext.apply(this,{layout:"card",cardSwitchAnimation:"flip",items:[b,a]});Brandwatch.views.TopSites.superclass.initComponent.apply(this)},showFront:function(){this.setActiveItem("topsitesTab")},showBack:function(a){var b=a.data.sitevolume;var c=b+" on "+a.data.sitename;this.setActiveItem("filteredMentionsTopsites");this.fireEvent("showpanelback",c)}});Brandwatch.views.TopTweeters=Ext.extend(Ext.Panel,{fullscreen:true,layout:"fit",iconCls:"toptweeters",listeners:{show:function(a){Brandwatch.stores.filteredMentionsStore.clearFilter(false);this.showFront()}},initComponent:function(){var c=this;var b=new Ext.List({id:"toptweetersTab",store:Brandwatch.stores.topsitesStore,emptyText:'<div style="margin:5px;">No sites cached.</div>',singleSelect:true,itemTpl:'<div class="list-item-title">{sitename} <div class="list-item-volume">{sitevolume}</div> </div>',listeners:{itemtap:function(i,k,o,l){var g=i.getRecord(o).get("sitename").toLowerCase();var f="";var d="";var n=Brandwatch.stores.settingsStore.findRecord("name","key").get("value");var m=Brandwatch.stores.settingsStore.findRecord("name","lastquery").get("value").id;var h=Brandwatch.stores.settingsStore.findRecord("name","startDate").get("value");var j=Brandwatch.stores.settingsStore.findRecord("name","endDate").get("value");populateMentions(n,m,h,j,Brandwatch.stores.filteredMentionsStore,d,f,g);c.showBack(i.getRecord(o))}}});var a=new Brandwatch.views.FilteredMentions({id:"filteredMentionsToptweeters",location:"toToptweeters"});Ext.apply(this,{layout:"card",cardSwitchAnimation:"flip",items:[b,a]});Brandwatch.views.TopTweeters.superclass.initComponent.apply(this)},showFront:function(){this.setActiveItem("toptweetersTab")},showBack:function(a){var b=a.data.sitevolume;var c=b+" on "+a.data.sitename;this.setActiveItem("filteredMentionsToptweeters");this.fireEvent("showpanelback",c)}});Brandwatch.views.CarouselView=Ext.extend(Ext.TabPanel,{id:"summaryViewId",listeners:{cardswitch:function(b,a){b.getDockedComponent("sentimenttoolbar").setTitle(a.title);this.getDockedComponent("sentimenttoolbar").getComponent("toggleSentiment").setText("Dashboard")}},onPanelCardSwitch:function(a){this.getDockedComponent("sentimenttoolbar").getComponent("toggleSentiment").setText("back");this.getDockedComponent("sentimenttoolbar").setTitle(a)},initComponent:function(){var d=new Brandwatch.controllers.QueryToolbar();var b=new Brandwatch.views.Sentiment({record:this.record.data,title:"Sentiment"});var e=new Brandwatch.views.History({record:this.record.data,title:"History"});var f=new Brandwatch.views.PageType({record:this.record.data,title:"Page Types"});var c=new Brandwatch.views.TopSites({record:this.record.data,title:"Top Sites"});var a=new Brandwatch.views.TopTweeters({record:this.record.data,title:"Top Tweeters"});var g=new Brandwatch.views.Mentions({record:this.record.data,title:"Mentions"});Ext.apply(this,{tabBar:{dock:"bottom",scroll:"horizontal",layout:{pack:"center"}},dockedItems:[{xtype:"toolbar",title:"Sentiment",id:"sentimenttoolbar",cls:"dashboardToolbar",items:[{xtype:"button",text:"Dashboard",cls:"buttonText",ui:"back",id:"toggleSentiment",handler:function(){var i=Brandwatch.stores.settingsStore.findRecord("name","lastQuery").get("value");if(this.getText()=="Dashboard"){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"backToDashboard",historyUrl:"overview",data:{data:i}})}else{var j=Brandwatch.views.mainView.getActiveItem();var h=j.getActiveItem();j.getDockedComponent("sentimenttoolbar").getComponent("toggleSentiment").setText("Dashboard");j.getDockedComponent("sentimenttoolbar").setTitle(h.title);h.showFront()}}}]},d],items:[b,e,f,c,a,g]});b.addListener("showpanelback",this.onPanelCardSwitch,this);e.addListener("showpanelback",this.onPanelCardSwitch,this),f.addListener("showpanelback",this.onPanelCardSwitch,this),c.addListener("showpanelback",this.onPanelCardSwitch,this),a.addListener("showpanelback",this.onPanelCardSwitch,this),g.addListener("showpanelback",this.onPanelCardSwitch,this),Brandwatch.views.CarouselView.superclass.initComponent.apply(this)}});Brandwatch.views.DashboardView=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){this.sentimentButton=new Ext.Button({record:this.record,html:'<img src="lib/resources/images/sentiment.png"/>',id:"sentiment-button",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"toSentiment",data:this.record,historyUrl:"sentiment"})}});this.historyButton=new Ext.Button({record:this.record,html:'<img src="lib/resources/images/history.png"/>',id:"history-button",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"toHistory",data:this.record,historyUrl:"history"})}});this.pagetypeButton=new Ext.Button({record:this.record,html:'<img src="lib/resources/images/pagetype.png"/>',id:"pagetype-button",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"toPagetype",data:this.record,historyUrl:"pagetype"})}});this.topsitesButton=new Ext.Button({record:this.record,html:'<img src="lib/resources/images/topsites.png"/>',id:"topsites-button",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"toTopsites",data:this.record,historyUrl:"topsites"})}});this.toptweetersButton=new Ext.Button({record:this.record,cls:"toptweeters-button",html:'<img src="lib/resources/images/toptweeters.png"/>',id:"toptweeters-button",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"toToptweeters",data:this.record,historyUrl:"toptweeters"})}});this.mentionsButton=new Ext.Button({record:this.record,html:'<img src="lib/resources/images/mentions.png"/>',id:"mentions-button",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"toMentions",data:this.record,historyUrl:"mentions"})}});this.dateButton=new Ext.Button({record:this.record,iconCls:"calendar",iconMask:true,ui:"plain",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"openCalendar",data:this.record,historyUrl:"dates"})}});this.backButton=Brandwatch.controllers.backButton;this.topToolbar=new Ext.Toolbar({title:"Dashboard",items:[this.backButton,{xtype:"spacer"},this.dateButton]});this.queryToolbar=new Brandwatch.controllers.QueryToolbar();this.dockedItems=[this.topToolbar,this.queryToolbar];this.dashboardPanel=new Ext.Panel({cls:"buttonWrap",scroll:"vertical",layout:{type:"vbox",align:"center"},items:[{xtype:"panel",layout:"hbox",align:"center",items:[this.sentimentButton,this.historyButton]},{xtype:"panel",layout:"hbox",align:"center",items:[this.pagetypeButton,this.topsitesButton]},{xtype:"panel",layout:"hbox",align:"center",items:[this.toptweetersButton,this.mentionsButton]}]});this.items=[this.dashboardPanel];Brandwatch.views.QueryView.superclass.initComponent.call(this)}});Brandwatch.views.LandingView=Ext.extend(Ext.Panel,{layout:"fit",initComponent:function(){this.logoutButton=new Ext.Button({text:"Logout",handler:function(){Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onLogout",historyUrl:"setFirstApplicationPage"})}});this.bottomToolbar=new Ext.Toolbar({id:"username",title:getUsername(),dock:"bottom"});this.topToolbar=new Ext.Toolbar({title:"Brandwatch",items:[{xtype:"spacer"},this.logoutButton]});this.dockedItems=[this.topToolbar,this.bottomToolbar];this.landingOptions=new Ext.List({store:this.landingStore,emptyText:'<div style="margin:5px;">No notes cached.</div>',onItemDisclosure:true,itemTpl:'<div class="list-item-title">{title}</div><div class="list-item-narrative">{narrative}</div>'});this.landingOptions.on("itemtap",function(b,c,d,f){var a=b.getRecord(d);this.onSelection(a)},this),this.items=[this.landingOptions];Brandwatch.views.LandingView.superclass.initComponent.call(this)},onSelection:function(a){var f="";var b="";var e={data:null};if(a.data.id=="1"){b="projects",f="onShowProjectView";e.data=a}else{if(a.data.id=="2"){for(var d=0;d<Brandwatch.stores.settingsStore.getCount();d++){if(Brandwatch.stores.settingsStore.getAt(d).data.name=="lastproject"){b="queries",f="onProjectSelection";e.data=Brandwatch.stores.settingsStore.getAt(d).data.value}}}else{if(a.data.id=="3"){for(var d=0;d<Brandwatch.stores.settingsStore.getCount();d++){if(Brandwatch.stores.settingsStore.getAt(d).data.name=="lastquery"){b="overview",f="onQuerySelection";e.data=Brandwatch.stores.settingsStore.getAt(d).data.value}}}else{if(a.data.id=="4"){for(var d=0;d<Brandwatch.stores.settingsStore.getCount();d++){b="alerts",f="onShowAlertView";e.data=a}}}}}var c={controller:Brandwatch.controllers.controller,action:"showLandingView"};Brandwatch.controllers.backButton.addToBackStack(c);Ext.dispatch({historyUrl:b,controller:Brandwatch.controllers.controller,action:f,data:e})},refreshList:function(){this.landingOptions.refresh()}});function getUsername(){for(var a=0;a<Brandwatch.stores.settingsStore.getCount();a++){if(Brandwatch.stores.settingsStore.getAt(a).data.name=="userEmail"){return Brandwatch.stores.settingsStore.getAt(a).data.value}}}Brandwatch.views.LoginView=Ext.extend(Ext.form.FormPanel,{scroll:"vertical",initComponent:function(){this.topToolbar=new Ext.Toolbar({title:"Brandwatch"});this.fields={xtype:"fieldset",submitOnAction:true,id:"login",defaults:{labelAlign:"left",labelWidth:"40%"},items:[{xtype:"emailfield",name:"email",label:"Email",},{xtype:"passwordfield",name:"password",label:"Password",},{xtype:"checkboxfield",id:"RememberMe",cls:"x-checkbox",name:"RememberMe",label:"Remember Login"}]};this.login=new Ext.Button({cls:"loginbutton",text:"Login",handler:loginTap=function(){Ext.dispatch({controller:"Controller",action:"onLogin",data:Brandwatch.views.LoginView.getValues(),historyUrl:"landing"})}});this.makeVisible=function(){this.forgotten.items.items[1].show();this.forgotten.items.items[2].show();this.forgotten.items.items[3].show()};this.forgotten=new Ext.Container({items:[{xtype:"container",id:"forgotten",html:'<a href="#" onclick="Brandwatch.views.LoginView.makeVisible()">Forgotten your password?</a>'},{xtype:"emailfield",cls:"forgottenfield",name:"emailforgotten",label:"Enter your email",hidden:true,required:true},{xtype:"container",cls:"forgottenfield",html:"We'll email you a link to a page where you can set a new password.",hidden:true},{xtype:"button",cls:"loginbutton",text:"Continue",hidden:true,handler:continueTap=function(){Ext.dispatch({controller:"Controller",action:"oncontinue"})}}]});this.dockedItems=[this.topToolbar];this.items=[this.fields,this.login,this.forgotten];Brandwatch.views.LoginView.superclass.initComponent.call(this)}});Brandwatch.views.ProjectsView=Ext.extend(Ext.Panel,{fullscreen:true,layout:"card",initComponent:function(){Brandwatch.stores.projectStore.clearFilter();this.backButton=Brandwatch.controllers.backButton;this.topToolbar=new Ext.Toolbar({title:"Projects",items:[this.backButton,{xtype:"spacer"},{iconCls:"search",iconMask:true,ui:"plain",listeners:{scope:this,tap:this.onSearchTap}}]});this.cancelSearchProjectsToolbar=new Ext.Toolbar({hidden:true,title:"Search Projects",items:[{xtype:"button",text:"cancel",ui:"back",cls:"buttonText",listeners:{scope:this,tap:this.onSearchCancel}}]});this.searchBar=new Ext.Toolbar({ui:"light",hidden:true,cls:"searchBar",items:[{xtype:"searchfield",placeHolder:"Search",name:"searchfield",listeners:{scope:this,keyup:this.onSearchInput}}]});this.dockedItems=[this.topToolbar,this.cancelSearchProjectsToolbar,this.searchBar];this.projectList=new Ext.List({id:"projects",store:this.projectStore,emptyText:'<div style="margin:5px;">You have no projects, please create one at <a href="app.brandwatch.com">app.brandwatch.com</a></div>',onItemDisclosure:true,itemTpl:'<div class="list-item-title">{name}</div><div class="list-item-narrative">{narrative}</div>'});this.listPanel=new Ext.Panel({items:[this.projectList],scroll:"vertical",layout:"fit"});this.projectList.on("itemtap",function(b,c,d,f){var a=b.getRecord(d);this.onProjectSelection(a)},this),this.items=[this.listPanel];Brandwatch.views.LandingView.superclass.initComponent.call(this)},onProjectSelection:function(a){var b={controller:Brandwatch.controllers.controller,action:"onShowProjectView"};Brandwatch.controllers.backButton.addToBackStack(b);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onProjectSelection",data:a,historyUrl:"queries"})},onSearchInput:function(b){var a=b.getValue().toLowerCase();Brandwatch.stores.projectStore.filterBy(function(c){if(c.get("name").toLowerCase().match(".*"+a+".*")){return true}return false})},onSearchTap:function(){this.cancelSearchProjectsToolbar.setVisible(true);this.cancelSearchProjectsToolbar.setPosition(0,0);this.cancelSearchProjectsToolbar.setWidth(this.getWidth());this.topToolbar.hide();this.searchBar.setVisible(true);this.searchBar.setWidth(this.getWidth());this.searchBar.setHeight(40);this.listPanel.setPosition(0,40)},onSearchCancel:function(){this.cancelSearchProjectsToolbar.hide();this.topToolbar.setVisible(true);this.searchBar.hide();this.listPanel.setPosition(0,0)}});Brandwatch.views.QueryView=Ext.extend(Ext.Panel,{fullscreen:true,layout:"card",initComponent:function(){this.backButton=Brandwatch.controllers.backButton;this.topToolbar=new Ext.Toolbar({title:"Queries",items:[this.backButton,{xtype:"spacer"},{iconCls:"search",iconMask:true,ui:"plain",listeners:{scope:this,tap:this.onSearchTap}}]});this.cancelSearchQueriesToolbar=new Ext.Toolbar({hidden:true,title:"Search Queries",items:[{xtype:"button",text:"cancel",ui:"back",cls:"buttonText",listeners:{scope:this,tap:this.onSearchCancel}}]});this.searchBar=new Ext.Toolbar({ui:"light",hidden:true,cls:"searchBar",items:[{xtype:"searchfield",placeHolder:"Search",name:"searchfield",listeners:{scope:this,keyup:this.onSearchInput}}]});this.dockedItems=[this.topToolbar,this.cancelSearchQueriesToolbar,this.searchBar];this.queryList=new Ext.List({store:this.queryStore,emptyText:'<div style="margin:5px;">No queries cached.</div>',onItemDisclosure:true,itemTpl:'<div class="list-item-title">{name}</div>'});this.listPanel=new Ext.Panel({items:[this.queryList],scroll:"vertical",layout:"fit"});this.queryList.on("itemtap",function(b,c,d,f){var a=b.getRecord(d);this.onQuerySelection(a)},this),this.items=[this.listPanel];Brandwatch.views.QueryView.superclass.initComponent.call(this)},onQuerySelection:function(a){var b={controller:Brandwatch.controllers.controller,action:"onProjectSelection",data:{data:Brandwatch.stores.settingsStore.findRecord("name","lastProject").get("value")}};Brandwatch.controllers.backButton.addToBackStack(b);Ext.dispatch({controller:Brandwatch.controllers.controller,action:"onQuerySelection",data:a,historyUrl:"overview"})},onSearchInput:function(b){var a=b.getValue().toLowerCase();Brandwatch.stores.queryStore.filterBy(function(c){if(c.get("name").toLowerCase().match(".*"+a+".*")){return true}return false})},onSearchTap:function(){this.cancelSearchQueriesToolbar.setVisible(true);this.cancelSearchQueriesToolbar.setPosition(0,0);this.cancelSearchQueriesToolbar.setWidth(this.getWidth());this.topToolbar.hide();this.searchBar.setVisible(true);this.searchBar.setWidth(this.getWidth());this.searchBar.setHeight(40);this.listPanel.setPosition(0,40)},onSearchCancel:function(){this.cancelSearchQueriesToolbar.hide();this.topToolbar.setVisible(true);this.searchBar.hide();this.listPanel.setPosition(0,0)}});